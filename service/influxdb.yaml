dsl_version: 0.1.0
service:
  name: influxdb
  ports:
    - {{ influxdb.port }}
  containers:
    - name: influxdb
      image: influxdb
      daemon:
        command: influxd -config /etc/influxdb/influxdb.conf
        files:
          - influxdb.conf
      # {% if grafana is defined and grafana.enable %}
      post:
        - name: stacklight-grafana-configure
          command: /opt/ccp/bin/grafana-configure.sh
          type: single
          dependencies:
            - grafana
          files:
            - grafana-configure.sh
            - kubernetes-dashboard
            - system-dashboard
      # {% endif %}
      volumes:
        - name: influxdb-data
          type: empty-dir
          path: /var/lib/influxdb
files:
  influxdb.conf:
    path: /etc/influxdb/influxdb.conf
    content: influxdb.conf.j2
    perm: "0600"
  grafana-configure.sh:
    path: /opt/ccp/bin/grafana-configure.sh
    content: grafana-configure.sh.j2
    perm: "0755"
  kubernetes-dashboard:
    path: /tmp/kubernetes.dashboard.json
    content: kubernetes.dashboard.json
  system-dashboard:
    path: /tmp/system.dashboard.json
    content: system.dashboard.json
